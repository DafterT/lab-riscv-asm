# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 1. RISC‚ÄëV ASM + C

## –í–∞—Ä–∏–∞–Ω—Ç –∑–∞–¥–∞–Ω–∏—è

–ù–∞–π—Ç–∏ —Å—Ç–æ–ª–±–µ—Ü –≤ –º–∞—Ç—Ä–∏—Ü–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π
—ç–ª–µ–º–µ–Ω—Ç–æ–≤. (N = 4, M = 4)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ üìÅ asm_prog
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ main.asm
‚îú‚îÄ‚îÄ üìÅ c_prog
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ main.c
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ c_prog.out
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ asm_prog.efi
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ asm_prog.dump
‚îú‚îÄ‚îÄ üìÑ Makefile
‚îî‚îÄ‚îÄ üìÑ README.md
```
–í üìÅ asm_prog —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ RISC-V (üìÑ main.asm) –¥–ª—è —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ [Venus](https://venus.kvakil.me/).

–í üìÅ c_prog —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤—Å–µ, —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –°–∏, –∞ –∏–º–µ–Ω–Ω–æ –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã (üìÑ main.c), –∏—Å–ø–æ–ª—è–µ–º—ã–π —Ñ–∞–π–ª (üìÑ c_prog.out), —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –°–∏ –∫–æ–¥ –ø–æ–¥ RISC-V (üìÑ asm_prog.efi) –∏ –¥–∞–º–ø —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ (üìÑ asm_prog.dump).

## –°–±–æ—Ä–∫–∞
–î–ª—è —Å–±–æ—Ä–∫–∏ –°–∏ –≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```
make
```
–Ω–∞—Ö–æ–¥—è—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å `Makefile`. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è —Å–±–æ—Ä–∫–∞ –°–∏ –∫–æ–¥–∞, –≤–∫–ª—é—á–∞—è –∏—Å–ø–æ–ª—è–Ω–µ–º—ã–π —Ñ–∞–π–ª –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É, —Ñ–∞–π–ª –ø–æ–¥ RISC-V –∏ –¥–∞–º–ø —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞.

–î–ª—è –æ—Ç—á–∏—Å—Ç–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```
make clean
```
## –ê–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –°–∏

### –û–ø–∏—Å–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏—è `max_sum_col_index()` –≤—ã—á–∏—Å–ª—è–µ—Ç —Å—É–º–º—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –º–∞—Ç—Ä–∏—Ü—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω–¥–µ–∫—Å —Å—Ç–æ–ª–±—Ü–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π. –ú–∞—Ç—Ä–∏—Ü–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ (row-major order).

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```c
int max_sum_col_index(int *a, int rows, int cols)
{
    int i, j;
    int max_col = 0;
    int max_sum = 0;
    int sum;

    for (j = 0; j < cols; j++) {
        sum = 0;
        for (i = 0; i < rows; i++) {
            sum = sum + a[i * cols + j];
        }
        if (j == 0 || sum > max_sum) {
            max_sum = sum;
            max_col = j;
        }
    }

    return max_col;
}


int main(void)
{
    int m[4][4] = {
        {  1,  2,  3,  4 },
        {  5,  6,  7,  8 },
        {  9, 10, 11, 12 },
        { 13, 14, 15, 16 }
    };

    int idx = max_sum_col_index(&m[0][0], 4, 4);

    printf("%d\n", idx);

    return 0;
}
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–≥–æ–Ω—ã (C)
–ù–∞ –º–∞—Å—Å–∏–≤–µ:
```c
    int m[4][4] = {
        {  1,  2,  3,  4 },
        {  5,  6,  7,  8 },
        {  9, 10, 11, 12 },
        { 13, 14, 15, 16 }
    };
```
–ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É:
```
$ ./c_prog.out
3
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**: —Å—Ç–æ–ª–±—Ü—ã –∏–º–µ—é—Ç —Å—É–º–º—ã 28, 32, 36, 40. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 40 –≤ —Å—Ç–æ–ª–±—Ü–µ —Å –∏–Ω–¥–µ–∫—Å–æ–º 3.

–û–±–Ω–æ–≤–∏–º –º–∞—Å—Å–∏–≤:
```c
int m[4][4] = {
    { -34,  12,  45, -8 },
    {  23, -49,   0, 17 },
    { -15,  38, -22,  5 },
    {  50, -41,  29, -6 }
};
```
–ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É:
```
$ ./c_prog.out
2
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**: —Å—Ç–æ–ª–±—Ü—ã –∏–º–µ—é—Ç —Å—É–º–º—ã 24, -40, 52, 8. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 52 –≤ —Å—Ç–æ–ª–±—Ü–µ —Å –∏–Ω–¥–µ–∫—Å–æ–º 2.
## –ê–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ RISC-V

### –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ RISC-V —Å–ª–µ–¥—É–µ—Ç —Ç–æ–π –∂–µ –ª–æ–≥–∏–∫–µ —Å –¥–≤—É–º—è –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏. –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ —Å—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã s0‚Äìs4 (callee-saved), –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ a0‚Äìa2 –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ a0.

**–†–µ–≥–∏—Å—Ç—Ä—ã:**
- `s0`: —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–∞—Ç—Ä–∏—Ü—É
- `s1`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
- `s2`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤
- `s3`: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–π–¥–µ–Ω–Ω–∞—è —Å—É–º–º–∞
- `s4`: –∏–Ω–¥–µ–∫—Å —Å—Ç–æ–ª–±—Ü–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π
- `t0`: —Å—á–µ—Ç—á–∏–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ (j)
- `t1`: —Ç–µ–∫—É—â–∞—è —Å—É–º–º–∞ (sum)
- `t2`: —Å—á–µ—Ç—á–∏–∫ —Å—Ç—Ä–æ–∫ (i)

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```asm
    .data
matrix:     # 4—Ö4
    .word 1, 2, 3, 4
    .word 5, 6, 7, 8
    .word 9, 10, 11, 12
    .word 13, 14, 15, 16

    .text
    .globl main

max_sum_col_index:
    addi sp, sp, -32    # –í—ã–¥–µ–ª—è–µ–º 32 –±–∞–π—Ç–∞ –Ω–∞ —Å—Ç–µ–∫
    sw ra, 28(sp)       # —Å–æ—Ö—Ä–∞–Ω—è–µ–º ra
    sw s0, 24(sp)       # —Å–æ—Ö—Ä–∞–Ω—è–µ–º s0
    sw s1, 20(sp)       # —Å–æ—Ö—Ä–∞–Ω—è–µ–º s1
    sw s2, 16(sp)       # —Å–æ—Ö—Ä–∞–Ω—è–µ–º s2
    sw s3, 12(sp)       # —Å–æ—Ö—Ä–∞–Ω—è–µ–º s3
    sw s4, 8(sp)        # —Å–æ—Ö—Ä–∞–Ω—è–µ–º s4

    mv s0, a0           # s0 = a (—É–∫–∞–∑–∞—Ç–µ–ª—å)
    mv s1, a1           # s1 = rows
    mv s2, a2           # s2 = cols
    li s3, 0            # s3 = max_sum
    li s4, 0            # s4 = max_col

    li t0, 0            # j = 0

col_loop:
    bge t0, s2, col_end # if j >= cols, –≤—ã—Ö–æ–¥–∏–º

    li t1, 0            # sum = 0
    li t2, 0            # i = 0

row_loop:
    bge t2, s1, row_end # if i >= rows, –∫–æ–Ω–µ—Ü –ø–æ —Å—Ç—Ä–æ–∫–∞–º

    # –∞–¥—Ä–µ—Å a[i*cols + j]:
    mul t3, t2, s2      # t3 = i * cols
    add t3, t3, t0      # t3 = i * cols + j
    slli t3, t3, 2      # t3 = (i*cols + j)*4
    add t4, s0, t3      # t4 = &a[i*cols + j]
    lw t5, 0(t4)        # t5 = a[i*cols + j]

    add t1, t1, t5      # sum += a[i*cols + j]
    addi t2, t2, 1      # i++
    j row_loop
row_end:

    # if (j == 0 || sum > max_sum)
    bnez t0, check_sum  # –µ—Å–ª–∏ j != 0
    mv s3, t1           # max_sum = sum
    mv s4, t0           # max_col = j
    j next_col
check_sum:
    ble t1, s3, next_col
    mv s3, t1           # max_sum = sum
    mv s4, t0           # max_col = j

next_col:
    addi t0, t0, 1      # j++
    j col_loop

col_end:
    mv a0, s4           # —Ä–µ–∑—É–ª—å—Ç–∞—Ç (max_col) –≤ a0

    lw ra, 28(sp)
    lw s0, 24(sp)
    lw s1, 20(sp)
    lw s2, 16(sp)
    lw s3, 12(sp)
    lw s4, 8(sp)
    addi sp, sp, 32
    jr ra

# int main(void)
main:
    addi sp, sp, -16
    sw ra, 12(sp)

    la a0, matrix   # a0 = &matrix[0][0]
    li a1, 4        # rows = 4
    li a2, 4        # cols = 4
    call max_sum_col_index

    lw ra, 12(sp)
    addi sp, sp, 16
    
    mv a1, a0       
    li a0, 1        # file descriptor = 1 (stdout)
    li a7, 10       # exit
    ecall

```

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–≥–æ–Ω—ã (ASM –≤ Venus)

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–∏–º—É–ª—Ç–æ—Ä–µ:
```
3
```
![–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—É—Å–∫–∞](pic/res_1.png)

–û–±–Ω–æ–≤–∏–º –º–∞—Å—Å–∏–≤:
```asm
    .word -34,  12,  45, -8
    .word  23, -49,   0, 17
    .word -15,  38, -22,  5
    .word  50, -41,  29, -6
```
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–∏–º—É–ª—Ç–æ—Ä–µ:
```
2
```
![–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—É—Å–∫–∞](pic/res_2.png)

## –ê–Ω–∞–ª–∏–∑ objdump
–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä RISC-V –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: `max_sum_col_index` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏ `main` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤—ã–≤–æ–¥–∞. –û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç frame pointer –∏ —Å–ª–µ–¥—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É ABI.

---

### –§—É–Ω–∫—Ü–∏—è max_sum_col_index (0x10140‚Äì0x10218)

**–ü—Ä–æ–ª–æ–≥ —Å–æ —Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:**
```
00010140 <max_sum_col_index>:
   10140:	fc010113          	addi sp,sp,-64      # –≤—ã–¥–µ–ª–µ–Ω–∏–µ 64 –±–∞–π—Ç –Ω–∞ —Å—Ç–µ–∫–µ
   10144:	02112e23          	sw ra,60(sp)        # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
   10148:	02812c23          	sw s0,56(sp)        # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ frame pointer
   1014c:	04010413          	addi s0,sp,64       # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ frame pointer
```

–§—É–Ω–∫—Ü–∏—è –≤—ã–¥–µ–ª—è–µ—Ç 64 –±–∞–π—Ç–∞ –Ω–∞ —Å—Ç–µ–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã. Frame pointer (s0) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º —á–µ—Ä–µ–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è: `[s0-20]` –¥–ª—è `i`, `[s0-24]` –¥–ª—è `j`, `[s0-28]` –¥–ª—è `max_col`, `[s0-32]` –¥–ª—è `max_sum`, `[s0-36]` –¥–ª—è `sum`.

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```
   10150:	fca42623          	sw	a0,-52(s0)      # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è –º–∞—Ç—Ä–∏—Ü—ã
   10154:	fcb42423          	sw	a1,-56(s0)      # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ rows
   10158:	fcc42223          	sw	a2,-60(s0)      # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cols
   1015c:	fe042223          	sw	zero,-28(s0)    # max_col = 0
   10160:	fe042023          	sw	zero,-32(s0)    # max_sum = 0
   10164:	fe042423          	sw	zero,-24(s0)    # j = 0
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ü–∏–∫–ª —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º –∞–¥—Ä–µ—Å–∞ —ç–ª–µ–º–µ–Ω—Ç–∞:**
```
   10178:	fc442583          	lw	a1,-60(s0)      # a1 = cols (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ø–∞–º—è—Ç–∏)
   1017c:	fec42503          	lw	a0,-20(s0)      # a0 = i
   10180:	110000ef          	jal	ra,10290        # –≤—ã–∑–æ–≤ __mulsi3 (—É–º–Ω–æ–∂–µ–Ω–∏–µ i * cols)
   10190:	00f707b3          	add	a5,a4,a5        # a5 = i*cols + j
   10194:	00279793          	slli a5,a5,0x2      # a5 *= 4 (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –±–∞–π—Ç—ã)
   1019c:	00f707b3          	add	a5,a4,a5        # a5 = –∞–¥—Ä–µ—Å —ç–ª–µ–º–µ–Ω—Ç–∞ &a[i*cols+j]
   101a0:	0007a783          	lw	a5,0(a5)        # –∑–∞–≥—Ä—É–∑–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
   101a8:	00f707b3          	add	a5,a4,a5        # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ sum
```

–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã–∑–æ–≤ `__mulsi3` –≤–º–µ—Å—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (RV32I –Ω–µ –∏–º–µ–µ—Ç —É–º–Ω–æ–∂–µ–Ω–∏—è).

**–£—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ (loop-back) —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —Å–º–µ—â–µ–Ω–∏–µ–º:**
```
   101b4:	00178793          	addi a5,a5,1        # i++
   101b8:	fef42623          	sw	a5,-20(s0)
   101c4:	faf74ae3          	blt	a4,a5,10178     # if (i < rows) –ø—Ä—ã–∂–æ–∫ –ù–ê–ó–ê–î –Ω–∞ 0x10178
```

–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ `faf74ae3` (–≤ –¥–≤–æ–∏—á–Ω–æ–º –≤–∏–¥–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ) —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç –∫ –Ω–∞—á–∞–ª—É —Ü–∏–∫–ª–∞.

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–∫—Å–∏–º—É–º–∞:**
```
   101cc:	00078863          	beqz a5,101dc       # if (j == 0) –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
   101d8:	00e7da63          	bge	a5,a4,101ec     # if (max_sum >= sum) –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   101dc:	fef42023          	sw	a5,-32(s0)      # max_sum = sum
   101e8:	fef42223          	sw	a5,-28(s0)      # max_col = j
```

**–≠–ø–∏–ª–æ–≥ —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:**
```
   10204:	fe442783          	lw	a5,-28(s0)      # a5 = max_col
   10208:	00078513          	mv	a0,a5           # –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ a0 (–≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
   1020c:	03c12083          	lw	ra,60(sp)       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ra
   10210:	03812403          	lw	s0,56(sp)       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ s0
   10214:	04010113          	addi sp,sp,64       # –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å—Ç–µ–∫–∞
   10218:	00008067          	ret                 # –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
```

---

### –§—É–Ω–∫—Ü–∏—è main (0x1021c‚Äì0x1028c)

**–ü—Ä–æ–ª–æ–≥ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã:**
```
0001021c <main>:
   1021c:	fa010113          	addi	sp,sp,-96    # –≤—ã–¥–µ–ª–µ–Ω–∏–µ 96 –±–∞–π—Ç –Ω–∞ —Å—Ç–µ–∫–µ
   10220:	04112e23          	sw	ra,92(sp)        # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ra
   10224:	04812c23          	sw	s0,88(sp)        # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ s0
   1022c:	000257b7          	lui	a5,0x25          # –∑–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Ä—Ö–Ω–∏—Ö 20 –±–∏—Ç –∞–¥—Ä–µ—Å–∞ –º–∞—Ç—Ä–∏—Ü—ã
   10230:	74478713          	addi	a4,a5,1860   # –ø–æ–ª–Ω–∞—è –∞–¥—Ä–µ—Å–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã –≤ –ø–∞–º—è—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
   1024c:	12c000ef          	jal	ra,10378         # –≤—ã–∑–æ–≤ memcpy –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ç—Ä–∏—Ü—ã –Ω–∞ —Å—Ç–µ–∫
```

–ú–∞—Ç—Ä–∏—Ü–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç–µ–∫ —á–µ—Ä–µ–∑ `memcpy`.

**–ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤—ã–∑–æ–≤ max_sum_col_index:**
```
   10250:	fac40793          	addi a5,s0,-84      # a5 = –∞–¥—Ä–µ—Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã
   10254:	00400613          	li	a2,4            # a2 = cols = 4
   10258:	00400593          	li	a1,4            # a1 = rows = 4
   1025c:	00078513          	mv	a0,a5           # a0 = –∞–¥—Ä–µ—Å –º–∞—Ç—Ä–∏—Ü—ã
   10260:	ee1ff0ef          	jal	ra,10140        # –≤—ã–∑–æ–≤ max_sum_col_index(matrix, 4, 4)
```

**–í—ã–∑–æ–≤ printf —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º:**
```
   10264:	fea42623          	sw	a0,-20(s0)      # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (max_col) –Ω–∞ —Å—Ç–µ–∫
   10268:	fec42583          	lw	a1,-20(s0)      # a1 = max_col (–≤—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä printf)
   1026c:	000257b7          	lui	a5,0x25         # –∑–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Ä—Ö–Ω–∏—Ö –±–∏—Ç –∞–¥—Ä–µ—Å–∞ —Å—Ç—Ä–æ–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ "%d\n"
   10270:	74078513          	addi a0,a5,1856     # a0 = –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å —Å—Ç—Ä–æ–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞
   10274:	33c000ef          	jal	ra,105b0        # –≤—ã–∑–æ–≤ printf("%d\n", max_col)
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `printf` —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä—ã a0 (—Ñ–æ—Ä–º–∞—Ç `"%d\n"`) –∏ a1 (–∑–Ω–∞—á–µ–Ω–∏–µ).

**–≠–ø–∏–ª–æ–≥:**
```
   10278:	00000793          	li	a5,0            # a5 = 0 (return 0)
   1027c:	00078513          	mv	a0,a5           # a0 = 0 (–≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ main)
   10280:	05c12083          	lw	ra,92(sp)
   10284:	05812403          	lw	s0,88(sp)
   10288:	06010113          	addi sp,sp,96
   1028c:	00008067          	ret
```

---

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:** –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç ra –∏ s0 –Ω–∞ —Å—Ç–µ–∫–µ –≤ –ø—Ä–æ–ª–æ–≥–µ, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤ —ç–ø–∏–ª–æ–≥–µ
2. **Frame pointer:** –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º —á–µ—Ä–µ–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è –æ—Ç s0
3. **Loop-back –ø–µ—Ä–µ—Ö–æ–¥—ã:** –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è –≤ `blt` —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ü–∏–∫–ª—ã
4. **–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞:** –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ (0x10140 –¥–ª—è max_sum_col_index, 0x105b0 –¥–ª—è printf, 0x10378 –¥–ª—è memcpy)
5. **–î–≤—É—Ö—à–∞–≥–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–¥—Ä–µ—Å–æ–≤:** `lui` + `addi` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∏–∑ –ø–∞–º—è—Ç–∏ .data

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≤ –ø–æ–ª–Ω–æ–º –¥–∞–º–ø–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—ä–µ–º —Å–ª—É–∂–µ–±–Ω–æ–≥–æ –∫–æ–¥–∞ (prologue –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, __libc_init_array, memset –∏ –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ runtime), –Ω–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –≤ max_sum_col_index –∏ main.

